# 虚拟小镇 TODO

## 里程碑 1：最小可运行
- [x] 时间/模拟核心：tick、time_scale；单步推进 `/simulate/step`；暂停/恢复（loop 待补）。
- [x] 世界状态：固定背景 + 1 场景（location）；基础环境字段。
- [x] 角色：创建角色 API（基本属性/性格/角色标记），列表和查询（列表/详情接口后补）。
- [x] 命运事件：简单规则 1-2 个（如随机相遇/早晨问候/坏运气）；事件队列与调度。
- [x] 交互/LLM：单一对话模板，能生成一段对话或内心反应（已接入 HTTP LLM，需配置真实模型）。
- [x] 日志：NDJSON 追加日志（tick、事件、对话），`/world/logs/tail` 返回真实尾部。
- [ ] 前端雏形：时间控制（play/pause/倍速）、事件流列表、角色列表 + 详情弹窗（简版）。
- [x] 技术栈落地（最小版）：后端 Python + FastAPI（复用现有 Parallax/uvicorn 框架），前端 React/Vite；日志本地文件；LLM 走 Parallax 已有模型（待接真模型）。

## 里程碑 2：基础扩展
- [ ] 人格漂移：事件/对话后按规则微调性格/关系。
- [ ] 记忆与摘要：角色记忆列表 + 摘要/衰减，限制 prompt 预算。
- [ ] 多地点：地点图与移动事件，角色位置感知。
- [ ] Fate 规则库：规则可配置（权重/开关），按背景标签触发。
- [ ] SSE/WebSocket：实时事件/日志流推送给前端。
- [ ] 快照与恢复：周期性保存世界/角色/事件状态（轻量存储）。
- [ ] 前端：地图/位置展示、日志过滤（事件/对话）、角色关系概览。
- [ ] 技术栈扩展决定：日志/事件持久化选型（SQLite 优先，后续可切 Postgres），API 版本化策略，配置管理（.env + typed config）。
- [x] LLM 集成：替换 DummyLLM 为真实 Parallax 调用，增加模型/温度/系统提示配置。
- [ ] 模拟循环控制：支持 start/stop（loop/pause）API，前端可切换持续运行或单步。

## 里程碑 3：进阶演化
- [ ] 背景演化：世界背景标签动态变化，反哺命运规则。
- [ ] 生命周期：出生/收养事件创建新角色，亲子关系自动建立。
- [ ] 多模型路由：对话 vs. 规划使用不同模型/参数；模型可配置。
- [ ] 数据库后端：SQLite/Postgres 持久化事件、对话、快照，附查询接口。
- [ ] 编辑工具：前端 Fate 规则/事件模板编辑与调试视图。
- [ ] 基础设施完善：队列/异步框架选择（仍用 asyncio / uvloop 或引入任务队列）、监控与指标、部署方式（单机 vs. 多节点 Parallax）、前端实时通道（SSE vs WebSocket）定稿。***
